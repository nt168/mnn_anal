# 初测结果3数据库测试结果总结
## 扩展验证测试体系

本测试结果包含4个重大测试任务，在初测结果1和2基础上，进行范围扩展、参数验证和跨模型对照测试。

---

## 一、测试设计概览

### 1.1 涉及任务
| 任务ID | 任务名称 | 执行时间 | 状态 |
|--------|----------|---------|------|
| 1 | mnn_llm_t1_c2_kvfalse_mmap0_dyo0_pn_vp_pf | 2025-11-27 10:37:56 - 12:44:46 | completed |
| 2 | mnn_llm_pn_sweep_step-p64-n32_mmp01 | 2025-11-27 12:44:46 - 16:08:42 | completed |
| 3 | mnn_llm_pn_sweep_step-p64-n32_dyo78 | 2025-11-27 16:08:42 - 19:35:43 | completed |
| 4 | mnn_llm_pn_sweep_step-n64-p32 | 2025-11-27 19:35:43 - 23:39:45 | completed |

### 1.2 测试Suite配置
| Suite名称 | 包含任务 | 模型数 | 测试用例数 | 测试目标 |
|------------|----------|--------|------------|----------|
| pn_grid_vp0 | 任务1 | 2 | 100 | 内部固定prompt模式0测试 |
| pn_grid_vp1 | 任务1 | 2 | 100 | 内部固定prompt模式1测试 |
| pn_grid_pf_file | 任务1 | 2 | 100 | 外部文件prompt模式测试 |
| pn_sweep_step-p64-n32_mmp01 | 任务2 | 2 | 128 | mmap参数深度扫描(0/1) |
| pn_sweep_step-p64-n32_n32_dyo78 | 任务3 | 2 | 128 | dynamicOption参数扫描(7/8) |
| pn_sweep_step-n64-p32 | 任务4 | 3 | 192 | 三模型标准基准测试 |

---

## 二、测试任务详细规格

### 2.1 任务1：Prompt模式对比验证测试

#### 测试目标
对比验证不同Prompt输入模式的性能表现。

#### 固定参数设计
```json
{
  "threads": 1,
  "precision": 2,
  "kv_cache": "false",
  "mmap": "0",
  "dynamicOption": 0,
  "repeat": 3
}
```

#### 测试变量设计
| Suite名称 | Prompt模式 | n_prompt范围 | n_gen范围 | 组合数 | 用例数/模型 |
|------------|------------|---------------|----------|--------|-------------|
| pn_grid_vp0 | vp=0 (内部固定模式0) | [96-168, 10点] | [32-64, 5点] | 50 | 50 |
| pn_grid_vp1 | vp=1 (内部固定模式1) | [96-168, 10点] | [32-64, 5点] | 50 | 50 |
| pn_grid_pf_file | prompt_file模式 | [96-168, 10点] | [32-64, 5点] | 50 | 50 |

#### 模型覆盖
- qwen3_06b
- hunyuan_05b

#### 数据量统计
- **测试用例总数**: 300 (150组合×3模式×2模型)
- **预期结果条目**: 600 (pp+tg各300)

### 2.2 任务2：mmap参数深度扫描测试

#### 测试目标
在大范围P/N组合下验证mmap=0/1参数的效果。

#### 固定参数设计
```json
{
  "threads": 1,
  "precision": 2,
  "vp": 1,
  "kv_cache": "false",
  "dynamicOption": 0,
  "repeat": 3
}
```

#### 测试变量设计
| 变量名 | 起始值 | 结束值 | 步长 | 值个数 |
|--------|--------|--------|------|--------|
| n_prompt | 64 | 1024 | 64 | 16 |
| n_gen | 32 | 128 | 32 | 4 |
| mmap | 0, 1 | - | - | 2 |

#### 测试矩阵计算
- **P/N组合**: 16×4 = 64组合
- **mmap条件**: 2个
- **总组合数**: 64×2 = 128组合
- **测试用例**: 128×2模型 = 256个

#### 模型覆盖
- qwen2_5_0_5b
- smolvlm2_256m

### 2.3 任务3：dynamicOption高级优化测试

#### 测试目标
测试dynamicOption 7/8级别在大范围P/N组合下的效果。

#### 固定参数设计
```json
{
  "threads": 1,
  "precision": 2,
  "vp": 1,
  "kv_cache": "false",
  "mmap": 0,
  "repeat": 3
}
```

#### 测试变量设计
| 变量名 | 起始值 | 结束值 | 步长 | 值个数 |
|--------|--------|--------|------|--------|
| n_prompt | 64 | 1024 | 64 | 16 |
| n_gen | 32 | 128 | 32 | 4 |
| dynamicOption | 7, 8 | - | - | 2 |

#### 测试矩阵计算
- **P/N组合**: 16×4 = 64组合
- **dynamicOption条件**: 2个
- **总组合数**: 64×2 = 128组合
- **测试用例**: 128×2模型 = 256个

#### 模型覆盖
- qwen2_5_0_5b
- smolvlm2_256m

### 2.4 任务4：三模型大规模基准测试

#### 测试目标
在标准化参数配置下实现多模型大范围P/N组合基准测试。

#### 固定参数设计
```json
{
  "threads": 1,
  "precision": 2,
  "mmap": "0",
  "dynamicOption": 0,
  "vp": 1,
  "kv_cache": "false",
  "repeat": 3
}
```

#### 测试变量设计
| 变量名 | 起始值 | 结束值 | 步长 | 值个数 |
|--------|--------|--------|------|--------|
| n_prompt | 64 | 1024 | 64 | 16 |
| n_gen | 32 | 128 | 32 | 4 |

#### 测试矩阵计算
- **P/N组合**: 16×4 = 64组合
- **测试用例**: 64×3模型 = 192个

#### 模型覆盖
- qwen2_5_0_5b
- llama_3_2_1b
- smolvlm2_256m

---

## 三、数据规格说明

### 3.1 核心性能指标
| 指标类型 | 指标含义 | 计算方式 | 单位 |
|----------|----------|----------|------|
| pp | Prefill阶段吞吐量 | token/秒 | token/s |
| tg | Decode阶段吞吐量 | token/秒 | token/s |

### 3.2 测试范围覆盖
#### 预填充长度(n_prompt)范围
- **最小值**: 64 tokens
- **最大值**: 1024 tokens
- **分布**: 等间隔采样，覆盖短到长文本范围

#### 生成长度(n_gen)范围
- **最小值**: 32 tokens
- **最大值**: 256 tokens
- **分布**: 等间隔采样，覆盖常见生成长度

### 3.3 参数类型说明
| 参数类型 | 本测试数值范围 | 说明 |
|----------|----------------|------|
| threads | 1 | 固定单线程执行 |
| precision | 2 | Low精度模式 |
| kv_cache | false | 关闭KV缓存 |
| mmap | 0, 1 | 内存映射开关 |
| dynamicOption | 0, 1, 7, 8 | 动态优化级别 |
| vp | 0, 1 | 内部prompt模式 |
| prompt_file | 外部文件路径 | 文件prompt模式 |

---

## 四、数据质量评估

### 4.1 数据完整性
- **总测试任务**: 4个
- **总测试Suite**: 6个
- **总测试用例**: 1,104个
- **成功完成**: 1,104个 (成功率100%)
- **失败用例**: 0个
- **总结果条目**: 2,008个 (每个用例pp+tg两个指标)

### 4.2 数据分布统计
| 任务ID | Suite数 | 用例数 | 模型数 | 结果条目 |
|--------|---------|--------|--------|----------|
| 1 | 3 | 300 | 2 | 600 |
| 2 | 1 | 256 | 2 | 512 |
| 3 | 1 | 256 | 2 | 512 |
| 4 | 1 | 192 | 3 | 384 |

### 4.3 跨模型覆盖
| 模型名称 | 出现任务数 | 总用例数 |
|------------|-------------|------------|
| qwen3_06b | 1 | 300 |
| hunyuan_05b | 1 | 300 |
| qwen2_5_0_5b | 3 | 704 |
| smolvlm2_256m | 3 | 704 |
| llama_3_2_1b | 1 | 192 |

---

## 五、测试设计特征说明

### 5.1 参数设计特征
- **范围扩展**: 相比1、2目录，P/N范围从更大范围和更密集采样
- **模式对比**: 任务1专门对比不同prompt输入模式的性能差异
- **参数验证**: 任务2、3专门验证mmap和dynamicOption参数效果
- **标准化**: 任务4采用标准化参数配置进行多模型基准测试

### 5.2 执行特征说明
- **线程固定**: 所有测试均使用单线程执行(threads=1)
- **重复测试**: 每个测试条件重复3次取统计值
- **多模型**: 不同任务涉及2-3个模型的横向对比
- **全域扫描**: P/N范围覆盖64-1024/32-256的实用范围

### 5.3 Suite划分逻辑
- **按功能划分**: prompt模式、内存映射、动态优化、基准测试
- **按参数划分**: 每个Suite专注特定参数的测试
- **按模式划分**: 不同输入和优化模式的独立测试
- **按模型划分**: 不同模型类型的性能基准建立

---

## 六、数据规格总览

### 6.1 测试规模统计
- **总执行时间**: 约14.5小时 (4个任务累计)
- **平均任务时长**: 3.6小时/任务
- **平均单用例时间**: 约47秒/用例

### 6.2 参数配置统计
| 测试类型 | 固定参数 | 可变参数 | P/N组合数 | 模型数 |
|----------|----------|----------|------------|--------|
| prompt模式对比 | 6个 | prompt模式 | 150×3 | 2 |
| mmap深度扫描 | 6个 | mmap | 128 | 2 |
| 高级优化测试 | 6个 | dynamicOption | 128 | 2 |
| 三模型基准 | 7个 | 无 | 64 | 3 |

---

## 七、与前期测试的关系

### 7.1 相对于初测结果1
- **范围扩大**: P/N范围从16×8扩展到16×4更大范围
- **参数增加**: 从基础配置扩展到包含mmap、dynamicOption等
- **模式增加**: 增加prompt输入模式的对比验证

### 7.2 相对于初测结果2
- **参数验证**: 对2目录发现的mmap、dynamicOption进行大范围验证
- **模型扩展**: 从2个模型扩展到3个模型的覆盖
- **范围扩展**: P/N范围从小规模测试扩展到大规模扫描

### 7.3 测试体系位置
- **初测结果1**: 基础P/N关系建立
- **初测结果2**: 关键参数影响分析
- **初测结果3**: 扩展验证和多模型基准

---

## 八、技术规格说明

### 8.1 环境配置
- **CPU亲和性**: taskset -c 1 (固定CPU核心执行)
- **超时设置**: 600秒/用例
- **重复次数**: 3次/条件
- **并发控制**: 单任务串行执行

### 8.2 文件规格
- **数据库文件**: benchmark_results.db (839,680 bytes)
- **表结构**: tasks, suites, case_definitions, benchmark_results等
- **索引能力**: 基于case_id和result_type的查询优化

---

**最后更新**: 2025年11月28日
**测试版本**: EAO初测阶段 T4测试