# 生成长度参数优化预实验（备选方案）
**版本：Complex Method v1.0**

## 实验目标
确定最优生成长度（32/64/128），平衡敏感度、稳定性和效率

## 1. 数据采集规范

### 1.1 核心测量指标
- **tg数据**：LLM_bench直接测量的生成速度（token/秒）
- **tg的CV**：tg数据的变异系数，衡量生成速度的相对波动程度
- **物理意义**：tg的CV越低，说明该实验配置下的推理性能越稳定
- **优势**：直接使用测量值，避免时间转换引入的误差

### 1.2 数据采集方法
- **测量对象**：直接使用LLM_bench输出的tg值（生成速度）
- **数据处理**：每组重复10次，记录tg值和标准差，计算tg的CV
- **计算公式**：`tg_CV = std(tg数据) / mean(tg数据)`
- **实验分组**：3个提示词区间 × 3个生成长度 × 10次重复

### 1.3 实验分组示例
```
生成长度32：
- 组1：生成长度32 + 提示词区间[8-16]
  → 测试提示词长度：8(5次) + 16(5次)
  → 得到10个tg数据 → 计算tg_CV_8-16

- 组2：生成长度32 + 提示词区间[32-48]
  → 测试提示词长度：32(5次) + 48(5次)
  → 得到10个tg数据 → 计算tg_CV_32-48

- 组3：生成长度32 + 提示词区间[64-128]
  → 测试提示词长度：64(5次) + 128(5次)
  → 得到10个tg数据 → 计算tg_CV_64-128
```

### 1.4 实验设计说明
- **直接测量**：使用LLM_bench原始输出，提高准确性
- **端点测试**：每个区间测试两端（最小值和最大值）
- **统计可靠**：各5次，确保足够样本量
- **操作简化**：避免中间转换，减少计算步骤

## 2. 核心指标计算

### 2.1 CV敏感度
- **定义**：测量方法对提示词长度变化的敏感程度
- **计算方式**：
  ```
  对于生成长度X：
  CV_短 = tg_CV_8-16
  CV_中 = tg_CV_32-48
  CV_长 = tg_CV_64-128

  CV敏感度 = |CV_长 - CV_短| / CV_短
  ```
- **评价**：越大越好，能区分不同提示词长度影响
- **验证要求**：单调趋势检查（CV_长 ≤ CV_中 ≤ CV_短）
- **含义**：tg的CV越低，生成速度越稳定

### 2.2 测量稳定性指标
- **定义**：生成长度作为测量工具的稳定性（原"噪声水平"）
- **计算方式**：
  ```
  Stability_Index = std(CV_短, CV_中, CV_长) / mean(CV_短, CV_中, CV_长)
  ```
- **评价**：越小越好，测量工具本身稳定可靠
- **命名说明**：避免与"tg的CV"混淆，强调测量工具稳定性
- **优势**：直接基于LLM_bench输出，无需转换

### 2.3 平均测试效率
- **定义**：该生成长度下完成测试的平均绝对时间
- **计算方式**：
  ```
  对于每个测试组：
  绝对时间 = 生成长度 ÷ tg值

  平均测试时间 = mean(所有测试组的绝对时间)
  ```
- **评价**：时间越短，测试效率越高
- **物理意义**：直接反映实际测试所需的时间成本
- **关键洞察**：tg高但生成长度大，总时间可能更长

#### 2.3.1 示例说明
```
生成长度128，tg=10 → 测试时间=128÷10=12.8秒
生成长度32，tg=50 → 测试时间=32÷50=0.64秒
虽然32的tg更高，但实际测试时间更短，效率更高
```

## 3. 归一化处理

### 3.1 原始指标收集
对生成长度32、64、128分别得到：
- CV敏感度（正向指标，越大越好）
- Stability_Index（负向指标，越小越好）
- 平均测试时间（负向指标，越小越好）

### 3.2 Min-Max归一化
```
# 正向指标归一化
Norm_Sensitivity = (Sensitivity - min_Sensitivity) / (max_Sensitivity - min_Sensitivity)

# 负向指标归一化（转换为越大越好）
Norm_Stability = 1 - (Stability - min_Stability) / (max_Stability - min_Stability)
Norm_Time = 1 - (Time - min_Time) / (max_Time - min_Time)
```
**备注**：测试时间直接作为负向指标，时间越短效率越高
**结果**：所有指标统一到[0,1]区间，且都是越大越好

## 4. 综合评分决策

### 4.1 计算公式
```
综合评分 = w1 × Norm_Sensitivity + w2 × Norm_Stability + w3 × Norm_Time
权重：w1=0.4（敏感度），w2=0.3（稳定性），w3=0.3（效率）
```

### 4.2 决策标准
#### 主要标准：
- 选择综合评分最高的生成长度

#### 辅助验证标准：
- CV敏感度 > 20%（能够明显区分不同长度）
- Stability_Index < 15%（测量工具本身稳定）
- 中间区间 monotonic 验证（CV_长 ≤ CV_中 ≤ CV_短）
- 平均测试时间在可接受范围

### 4.3 决策过程验证
1. 检查单调趋势：确认测量方法的逻辑一致性
2. 检查阈值满足：确保基本质量要求
3. 综合评分最高：选择最优平衡点

## 5. 结果记录模板

```
生成长度32：
- 稳定性：CV_8=X%，CV_32=Y%，CV_64=Z%，最大CV=M%，平均=N%
- 区分能力：差异=D%，是否≥20%：是/否
- 效率：平均测试时间=T秒

生成长度64：
[similarly record]

生成长度128：
[similarly record]

**决策结果**：选择生成长度XX
**原因**：满足稳定性CV≤%，区分能力≥%，效率最高
```

## 6. 进入下一阶段条件
- 生成长度确定，参数设置优化完成
- 所有验证标准检查通过

---

**文件说明**：本方案采用复杂的多指标归一化方法，适用于需要高度科学严谨性的研究场景。如需更简化的版本，请参考主报告中的简化实验设计。

**适用场景**：需要发表论文、高标准学术要求的科研项目
**复杂度评估**：⭐⭐⭐⭐⭐（高）