<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ suite.name }} - MNN LLM Bench</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/suite_detail.css') }}">
</head>
<body>
    <!-- å…¨å±€æŠ˜å æ§åˆ¶æŒ‰é’® -->
    <button id="toggleAllBtn" class="toggle-all-btn" onclick="toggleAllTables()" title="æŠ˜å /å±•å¼€æ‰€æœ‰è¡¨æ ¼">
        <span id="toggleAllIcon">â–¼</span>
    </button>

    
    <div class="container">
        <div class="header">
            <h1>{{ suite.description }}</h1>
            <p>{{ suite.name }}</p>
            <div class="header-bottom">
                <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
                <div class="suite-id">ID: #{{ suite.id }}</div>
            </div>
        </div>

        <div class="content">
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">æ¨¡å‹</div>
                    <div class="info-value">{{ suite.model_name }}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">æ¨¡å‹å¤§å°</div>
                    <div class="info-value">{{ suite.model_size or 'N/A' }}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">åˆ›å»ºæ—¶é—´</div>
                    <div class="info-value">{{ suite.created_at }}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">æµ‹è¯•ç”¨ä¾‹æ•°é‡</div>
                    <div class="info-value">{{ cases|length }} ä¸ª</div>
                </div>
            </div>

            {% if analysis_results %}
            <div class="params-section">
                <div class="params-table-container">
                    <h3 class="params-table-header" onclick="toggleTable('analysis-reports')">
                        ğŸ“Š åˆ†ææŠ¥å‘Š ({{ analysis_results|length }} ä¸ª)
                        <span class="expand-arrow expanded" id="analysis-reports-arrow">â–¼</span>
                    </h3>
                    <div id="analysis-reports" class="collapsible-content expanded">
                        <table class="params-table analysis-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>è‡ªå˜é‡</th>
                                    <th>å› å˜é‡</th>
                                    <th>åˆ†æç±»å‹</th>
                                    <th>HTMLæŠ¥å‘Š</th>
                                    <th>Markdown</th>
                                    <th>å‹ç¼©åŒ…</th>
                                    <th>å®Œæˆæ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for analysis in analysis_results %}
                                <tr>
                                    <td>
                                        <span class="analysis-id">{{ analysis.id }}</span>
                                    </td>
                                    <td>
                                        <span class="analysis-variable">{{ analysis.target_variable }}</span>
                                    </td>
                                    <td>
                                        {% if analysis.result_types %}
                                        <div class="analysis-results">{{ analysis.result_types|join(', ')|upper }}</div>
                                        {% else %}
                                        <span class="no-data">æ— æ•°æ®</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="analysis-type-badge">{{ analysis.analysis_type|title }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ analysis.html_url }}" target="_blank" class="analysis-link html-link">
                                            ğŸ“„ æŸ¥çœ‹
                                        </a>
                                    </td>
                                    <td>
                                        {% if analysis.md_url %}
                                        <a href="{{ analysis.md_url }}" target="_blank" class="analysis-link md-link">
                                            ğŸ“ ä¸‹è½½
                                        </a>
                                        {% else %}
                                        <span class="no-file">æœªæä¾›</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if analysis.zip_url %}
                                        <a href="{{ analysis.zip_url }}" class="analysis-link zip-link" download>
                                            ğŸ“¦ ä¸‹è½½
                                        </a>
                                        {% else %}
                                        <span class="no-file">æœªæä¾›</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="analysis-time-short">{{ analysis.completed_at.split(' ')[0] if analysis.completed_at else '-' }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- å¥—ä»¶å›ºå®šå‚æ•°é…ç½®è¡¨ï¼ˆå¯æŠ˜å ï¼‰-->
            {% if suite.suite_fixed_values or suite.suite_default_values %}
            <div class="params-section">
                <div class="params-table-container">
                    <h3 class="params-table-header" onclick="toggleTable('suite-fixed-params')">
                        å¥—ä»¶å›ºå®šå‚æ•°é…ç½®
                        <span class="expand-arrow expanded" id="suite-fixed-params-arrow">â–¼</span>
                    </h3>
                    <div id="suite-fixed-params" class="collapsible-content expanded">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>ç±»å‹</th>
                                    <th>åç§°</th>
                                    <th>å€¼</th>
                                    <th>é•¿å‚æ•°å</th>
                                    <th>å¤‡æ³¨</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for param in suite.suite_fixed_values %}
                                <tr class="param-type-fixed">
                                    <td>
                                        <span class="param-type-badge param-type-fixed">{{ param.type }}</span>
                                    </td>
                                    <td>{{ param.param_meta.name }}</td>
                                    <td>{{ param.value }}</td>
                                    <td>{{ param.param_meta.cli }}</td>
                                    <td>{{ param.param_meta.note }}</td>
                                </tr>
                                {% endfor %}
                                {% for param in suite.suite_default_values %}
                                <tr class="param-type-default">
                                    <td>
                                        <span class="param-type-badge param-type-default">{{ param.type }}</span>
                                    </td>
                                    <td>{{ param.param_meta.name }}</td>
                                    <td>{{ param.value }}</td>
                                    <td>{{ param.param_meta.cli }}</td>
                                    <td>{{ param.param_meta.note }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if cases|length > 0 %}
                <div class="results-section">
                    <h2 class="section-title">æµ‹è¯•ç”¨ä¾‹è¯¦æƒ… ({{ cases|length }} ä¸ª)</h2>

                    {% for case in cases %}
                        <div class="case-card">
                            <div class="case-header">
                                <div class="case-title">{{ case.name }}</div>
                                <div class="case-header-second">
                                    <div class="case-meta">åˆ›å»ºæ—¶é—´: {{ case.created_at }}</div>
                                    {% if case.execution_time_seconds %}
                                    <div class="case-meta execution-time">æ‰§è¡Œæ—¶é—´: {{ "%.3f"|format(case.execution_time_seconds) }} ç§’</div>
                                    {% endif %}
                                    <div class="case-id">#{{ case.id }}</div>
                                </div>
                                <div class="case-status status-{{ case.status }}">{{ case.status|upper }}</div>
                            </div>

                            <!-- Caseçº§åˆ«çš„å˜é‡å‚æ•°æ˜¾ç¤º -->
                            {% if case.variable_params %}
                            <div class="params-table-container">
                                <h4 class="params-table-header" onclick="toggleTable('case-{{ case.id }}-vars')">
                                    å˜é‡å‚æ•°é…ç½®
                                    <span class="expand-arrow expanded" id="case-{{ case.id }}-vars-arrow">â–¼</span>
                                </h4>
                                <div id="case-{{ case.id }}-vars" class="collapsible-content expanded">
                                    <table class="params-table">
                                        <thead>
                                            <tr>
                                                <th>ç±»å‹</th>
                                                <th>åç§°</th>
                                                <th>å€¼</th>
                                                <th>é•¿å‚æ•°å</th>
                                                <th>å¤‡æ³¨</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for param in case.variable_params %}
                                            <tr class="param-type-variable">
                                                <td>
                                                    <span class="param-type-badge param-type-variable">å˜é‡</span>
                                                </td>
                                                <td>{{ param.param_meta.name }}</td>
                                                <td>{{ param.value }}</td>
                                                <td>{{ param.param_meta.cli }}</td>
                                                <td>{{ param.param_meta.note }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}

                            {% if case.results|length > 0 %}
                            <div class="params-table-container results-table-container">
                                <h4 class="params-table-header params-table-header-static">
                                    æµ‹è¯•ç»“æœ ({{ case.results|length }} é¡¹)
                                </h4>
                                <table class="params-table">
                                    <thead>
                                        <tr>
                                            <th>æµ‹è¯•ç±»å‹</th>
                                            <th>å‚æ•°</th>
                                            <th>æ€§èƒ½</th>
                                            <th>æ ‡å‡†å·®</th>
                                            <th>å•ä½</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for result in case.results %}
                                            <tr>
                                                <td>
                                                    <span class="result-type-{{ result.result_type|replace('+', '_') }}">
                                                        {{ result.result_type|upper }}
                                                    </span>
                                                </td>
                                                <td>{{ result.result_parameter }}</td>
                                                <td>
                                                    <span class="performance-value">{{ result.mean_value }}</span>
                                                </td>
                                                <td>{{ result.std_value }}</td>
                                                <td>{{ result.unit }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                                <div class="params-table-container results-table-container">
                                    <h4 class="params-table-header params-table-header-static">
                                        æµ‹è¯•ç»“æœ (0 é¡¹)
                                    </h4>
                                    <div class="case-results-empty">
                                        <p>æš‚æ— æµ‹è¯•ç»“æœ</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="results-section">
                    <h2 class="section-title">æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…</h2>
                    <div class="empty-results">
                        <div>ğŸ“Š</div>
                        <p>è¯¥å¥—ä»¶æš‚æ— æµ‹è¯•ç”¨ä¾‹</p>
                        <p>æµ‹è¯•è®¡åˆ’å·²åˆ›å»ºä½†ä»»åŠ¡æœªæ‰§è¡Œ</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

<script>
function toggleAllTables() {
    const allContents = document.querySelectorAll('.collapsible-content');
    const allButtons = document.querySelector('#toggleAllBtn');
    const toggleIcon = document.querySelector('#toggleAllIcon');

    // è·å–æ‰€æœ‰å¯æŠ˜å çš„å†…å®¹
    const collapsibleContents = Array.from(allContents);

    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¯æŠ˜å è¡¨æ ¼éƒ½æ˜¯å±•å¼€çŠ¶æ€
    const allExpanded = collapsibleContents.every(content =>
        content.classList.contains('expanded')
    );

    if (allExpanded) {
        // å¦‚æœéƒ½æ˜¯å±•å¼€çš„ï¼Œåˆ™å…¨éƒ¨æ”¶èµ·
        collapsibleContents.forEach(content => {
            content.classList.remove('expanded');
        });
        document.querySelectorAll('.expand-arrow').forEach(arrow => {
            const content = document.getElementById(arrow.id.replace('-arrow', ''));
            if (content) {
                arrow.classList.remove('expanded');
                arrow.classList.add('collapsed');
            }
        });
        toggleIcon.textContent = 'â–¶';
        allButtons.title = 'å±•å¼€æ‰€æœ‰è¡¨æ ¼';
    } else {
        // å¦‚æœæœ‰æ”¶èµ·çš„ï¼Œåˆ™å…¨éƒ¨å±•å¼€
        collapsibleContents.forEach(content => {
            content.classList.add('expanded');
        });
        document.querySelectorAll('.expand-arrow').forEach(arrow => {
            const content = document.getElementById(arrow.id.replace('-arrow', ''));
            if (content) {
                arrow.classList.add('expanded');
                arrow.classList.remove('collapsed');
            }
        });
        toggleIcon.textContent = 'â–¼';
        allButtons.title = 'æŠ˜å æ‰€æœ‰è¡¨æ ¼';
    }
}

function toggleTable(tableId) {
    const content = document.getElementById(tableId);
    const arrow = document.getElementById(tableId + '-arrow');

    if (content) {
        content.classList.toggle('expanded');
    }

    if (arrow) {
        arrow.classList.toggle('expanded');
        arrow.classList.toggle('collapsed');
    }
}

function toggleAnalysisDropdown() {
    const menu = document.getElementById('analysisMenu');
    const arrow = document.querySelector('.dropdown-arrow');

    if (menu) {
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        arrow.style.transform = menu.style.display === 'block' ? 'rotate(180deg)' : 'rotate(0deg)';
    }
}

// ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
document.addEventListener('click', function(event) {
    const dropdown = document.querySelector('.analysis-dropdown');
    const menu = document.getElementById('analysisMenu');

    if (dropdown && !dropdown.contains(event.target) && menu.style.display === 'block') {
        menu.style.display = 'none';
        document.querySelector('.dropdown-arrow').style.transform = 'rotate(0deg)';
    }
});
</script>

</body>
</html>